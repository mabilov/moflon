package de.abilov.booksale
actors sys as system
sales as person "Sales"
financing as person "Financing"
shipping as person "Shipping"
usecase booksale "Book Sale Process"
preconditions "Order Received"
basic flow
	step record_order "Record Order" perform by sys next check_stock
	step check_stock "Check Stock" perform by sys next all_books_available
	step all_books_available "All books available" alt by sys
	alternatives
		if "No" then alternative flow ShipmentPrepare
	else next pgw1
	parallel step pgw1 "pgw1" payment , shipment_prepare next deliver_books_customer
	step deliver_books_customer "Deliver books to customer" perform by shipping next delivery_confirmed
	step delivery_confirmed "Delivery confirmed" wait by sys
end flow with postcondition "Order processed successfully"
alternative flow ShipmentPrepare
	step deliver_books_stock "Deliver books to stock" perform by shipping
end flow
parallel flow payment
	step charge_issue "Charge Issue" perform by sys
	step wait_for_event "Wait for event" alt by sys
	alternatives
		if "delay > 5 days" then alternative flow delay_5d
		if "Payment Received" then alternative flow payment_received
	else
end flow
parallel flow shipment_prepare
	step separate_books "Separate books of the request" perform by shipping
end flow
alternative flow delay_5d
end flow with postcondition "Cancel order"
alternative flow payment_received
	step issue_invoice "Issue invoice" perform by financing
end flow end usecase end package